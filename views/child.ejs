<!DOCTYPE html>
<html>
<head>
    <title>Child Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1>My Chores</h1>

    <div class="chores-list">
        <% chores.forEach(function(chore) { %>
            <div class="chore-item <%= chore.completed ? 'completed' : '' %>" data-id="<%= chore.id %>">
                <input type="checkbox" 
                       class="chore-checkbox" 
                       <%= chore.completed ? 'checked' : '' %>
                       onchange="toggleChore(<%= chore.id %>)">
                <span class="chore-name"><%= chore.name %></span>
                <span class="completion-status">
                    Status: <%= chore.completed ? 'Completed' : 'Pending' %>
                </span>
                <% if (chore.completedAt) { %>
                    <span class="completed-at">
                        Completed: <%= new Date(chore.completedAt).toLocaleString() %>
                    </span>
                <% } %>
            </div>
        <% }); %>
    </div>

    <a href="/logout" class="logout-btn">Logout</a>

    <script>
    function toggleChore(choreId) {
        fetch(`/toggle-chore/${choreId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const choreElement = document.querySelector(`[data-id="${choreId}"]`);
                if (data.completed) {
                    choreElement.classList.add('completed');
                } else {
                    choreElement.classList.remove('completed');
                }
                location.reload(); // Refresh to show updated completion status
            } else {
                alert('Error updating chore');
                location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating chore');
            location.reload();
        });
    }
    </script>
</body>
</html>